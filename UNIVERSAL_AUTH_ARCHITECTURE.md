# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –µ–¥–∏–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ú–µ—Ç–æ–¥—ã –≤—Ö–æ–¥–∞ (Auth Methods)

#### ‚úÖ Email/Password
- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:** `signUpWithEmail(email, password, fullName, gender)`
  - –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ–ª–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  - –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ email (–æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–ª—é—á)
  - –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø–æ email –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
  
- **–í—Ö–æ–¥:** `signInWithEmail(email, password)`
  - –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ email –ø–µ—Ä–µ–¥ –≤—Ö–æ–¥–æ–º
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ UUID

#### ‚úÖ Phone/OTP
- **–û—Ç–ø—Ä–∞–≤–∫–∞ OTP:** `signInWithPhone(phone)`
  - –û—Ç–ø—Ä–∞–≤–∫–∞ OTP-–∫–æ–¥–∞ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω
  
- **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ OTP:** `verifyPhoneOTP(phone, token)`
  - –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ phone (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É)
  - –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø–æ phone –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ email –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
  - `gender` –æ—Å—Ç–∞–µ—Ç—Å—è `null` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å –ø–æ–∑–∂–µ

#### ‚úÖ Telegram WebApp
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥:** `signInWithTelegram(telegramUser, initData?)`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `window.Telegram.WebApp.initDataUnsafe.user`
  - –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ `telegram_id` (–±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
  - –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É email `telegram_${id}@telegram.local`
  - –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º email –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è
  - `gender` –æ—Å—Ç–∞–µ—Ç—Å—è `null` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å –ø–æ–∑–∂–µ

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ '–ï–¥–∏–Ω–æ–≥–æ –ê–∫–∫–∞—É–Ω—Ç–∞' (Identity Linking)

**–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:**
- **Email** - –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–ª—é—á –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (Email, Google, Apple)
- **Phone** - –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–ª—é—á –¥–ª—è Phone/OTP –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **Telegram ID** - –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–ª—é—á –¥–ª—è Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **UUID** - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–ª—é—á –∏–∑ Supabase Auth (–≤—Å–µ–≥–¥–∞ —Å—Ç—Ä–æ–∫–∞)

**–õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**

1. **–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Email:**
   ```typescript
   // –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ email
   const { data: existingProfile } = await supabase
     .from('profiles')
     .select('id, email, gender')
     .eq('email', email.toLowerCase().trim())
     .single();
   
   // –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ UUID –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤
   if (existingProfile && existingProfile.id) {
     profileId = String(existingProfile.id);
   }
   ```

2. **–ü—Ä–∏ –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ Phone:**
   ```typescript
   // –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ phone (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É)
   const normalizedPhone = phone.replace(/\s+/g, '').replace(/[^\d+]/g, '');
   const { data: existingProfile } = await supabase
     .from('profiles')
     .select('id, phone, email, gender')
     .eq('phone', normalizedPhone)
     .single();
   
   // –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ UUID –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º email (–µ—Å–ª–∏ –µ—Å—Ç—å)
   if (existingProfile && existingProfile.id) {
     profileId = String(existingProfile.id);
   }
   ```

3. **–ü—Ä–∏ –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ Telegram:**
   ```typescript
   // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ telegram_id
   const { data: existingProfileByTelegramId } = await supabase
     .from('profiles')
     .select('id, email, phone, telegram_id, gender')
     .eq('telegram_id', telegramUser.id)
     .single();
   
   // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω - –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É email
   const tempEmail = `telegram_${telegramUser.id}@telegram.local`;
   const { data: existingProfileByEmail } = await supabase
     .from('profiles')
     .select('id, email, phone, gender')
     .eq('email', tempEmail)
     .single();
   
   // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–π UUID –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
   if (existingProfileByEmail && existingProfileByEmail.id) {
     profileId = String(existingProfileByEmail.id);
   }
   ```

4. **–ü—Ä–∏ OAuth —Ä–µ–¥–∏—Ä–µ–∫—Ç–µ (Google, Apple):**
   ```typescript
   // –í App.tsx onAuthStateChange
   const userEmail = session.user.email;
   if (userEmail) {
     // –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ email (–æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–ª—é—á)
     const { data: existingProfile } = await supabase
       .from('profiles')
       .select('id, email, gender')
       .eq('email', userEmail.toLowerCase().trim())
       .single();
     
     // –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω - —Å–≤—è–∑—ã–≤–∞–µ–º –∞–∫–∫–∞—É–Ω—Ç—ã (–æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å)
     if (existingProfile && String(existingProfile.id) !== String(session.user.id)) {
       // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å, –¥–æ–±–∞–≤–ª—è—è –¥–∞–Ω–Ω—ã–µ –∏–∑ OAuth
       await supabase
         .from('profiles')
         .update({ ... })
         .eq('id', String(existingProfile.id));
     }
   }
   ```

**–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–≤—è–∑—ã–≤–∞–Ω–∏—é Google/Apple:**
- –ü—Ä–∏ –ø–æ–∏—Å–∫–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **email** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª—é—á
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ Google/Apple —Å email, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –µ—Å—Ç—å –≤ –±–∞–∑–µ, –∞–∫–∫–∞—É–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≤—è–∑—ã–≤–∞—é—Ç—Å—è
- Email —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ –∏ –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

### 3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ–ª–∞ (Gender)

**–ñ–µ—Å—Ç–∫–æ–µ —É—Å–ª–æ–≤–∏–µ:**
- –ü–æ—Å–ª–µ **–ª—é–±–æ–≥–æ** —Å–ø–æ—Å–æ–±–∞ –≤—Ö–æ–¥–∞ (Email, Phone, Telegram, Google, Apple) –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–æ–ª–æ–Ω–∫–µ `gender`
- –ï—Å–ª–∏ `gender === null`, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ '–í—ã–±–æ—Ä –ø–æ–ª–∞' (`CompleteProfileScreen`)
- –î–æ—Å—Ç—É–ø –∫ –∫–∞—Ä—Ç–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ –≤—ã–±–æ—Ä–∞ –ø–æ–ª–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// –í App.tsx handleAuthSuccess
if (!user.gender) {
  console.log('‚ö†Ô∏è User gender is missing, redirecting to profile completion.');
  setNeedsProfileCompletion(true);
  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞—Ä—Ç–µ
} else {
  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  setNeedsProfileCompletion(false);
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
}

// CompleteProfileScreen
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å: –ú—É–∂—á–∏–Ω–∞ / –ñ–µ–Ω—â–∏–Ω–∞
// –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ updateUserGender()
```

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–∞:**
```typescript
// –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–æ–ª–∞ –≤ CompleteProfileScreen
await updateUserGender(userId, gender); // 'male' | 'female' | 'prefer_not_to_say'
// –ü–æ–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É profiles
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞—Ä—Ç–µ
```

### 4. –õ–æ–≥–∏–∫–∞ —Ä–µ–∂–∏–º–∞ 'Duo'

**–ê–∫—Ç–∏–≤–∞—Ü–∏—è:**
- –ñ–µ—Å—Ç: —Ä–∏—Å–æ–≤–∞–Ω–∏–µ –∫—Ä—É–≥–∞ –ø–∞–ª—å—Ü–µ–º + —Ç–∞–ø –≤ —Ü–µ–Ω—Ç—Ä
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç: `CircleGestureDetector`
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è: –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –ª–∏–Ω–∏—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏, —Ü–µ–Ω—Ç—Ä –∫—Ä—É–≥–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

**3D —Ä–∞–∑–≤–æ—Ä–æ—Ç:**
```typescript
// –í App.tsx
const handleCircleGestureComplete = (center: { x: number; y: number }) => {
  setIsFlipping(true);
  // Haptic feedback
  setTimeout(() => {
    activateDuoMode(); // –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ Duo
    setIsFlipping(false);
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç—É –ø–æ—Å–ª–µ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞
  }, 600);
};
```

**–°–æ–∑–¥–∞–Ω–∏–µ Duo-—Å–æ–±—ã—Ç–∏—è:**
```typescript
// –í —Ä–µ–∂–∏–º–µ Duo –ª—é–±–æ–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è Duo-—Å–æ–±—ã—Ç–∏–µ–º
const isDuoEvent = isDuoMode; // true –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω —Ä–µ–∂–∏–º Duo

await supabase
  .from('impulses')
  .insert({
    content: messageContent.trim(),
    category: categoryIdForDB,
    creator_id: userId, // UUID (—Å—Ç—Ä–æ–∫–∞)
    is_duo_event: isDuoEvent, // true –≤ —Ä–µ–∂–∏–º–µ Duo
    // ...
  });
```

**–õ–æ–≥–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤:**
- –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–ª—é–±–æ–π –ø–æ–ª) –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ —É—á–∞—Å—Ç–∏–µ –≤ Duo-—Å–æ–±—ã—Ç–∏–∏
- –ó–∞–ø—Ä–æ—Å—ã –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—é —Å–æ–±—ã—Ç–∏—è (—Å–∫—Ä—ã—Ç–Ω–æ)
- –°–æ–∑–¥–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –ø–æ –ø–æ–ª—É (male/female/all)
- –°–æ–∑–¥–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è
- –ü—Ä–∏—ë–º –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

### 5. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ñ–∏–∫—Å (Database Types)

**–ü—Ä–æ–±–ª–µ–º–∞:** `operator does not exist: uuid = bigint`

**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç—å UUID –∫ —Å—Ç—Ä–æ–∫–µ –ø—Ä–∏:
- –°—Ä–∞–≤–Ω–µ–Ω–∏—è—Ö: `String(id1) === String(id2)`
- –ó–∞–ø—Ä–æ—Å–∞—Ö –∫ –ë–î: `.eq('id', String(userId))`
- –ü–µ—Ä–µ–¥–∞—á–µ –≤ —Ñ—É–Ω–∫—Ü–∏–∏: `creatorId={String(selectedEventDetail.creator_id)}`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞:**

1. **–°—Ä–∞–≤–Ω–µ–Ω–∏—è UUID:**
   ```typescript
   // ‚ùå –ë—ã–ª–æ: if (event.creator_id === userId)
   // ‚úÖ –°—Ç–∞–ª–æ:
   if (String(event.creator_id) === String(userId))
   
   // ‚ùå –ë—ã–ª–æ: const isCreator = selectedEventDetail.creator_id === currentUserId
   // ‚úÖ –°—Ç–∞–ª–æ:
   const isCreator = String(selectedEventDetail.creator_id) === String(currentUserId)
   ```

2. **–ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î:**
   ```typescript
   // ‚ùå –ë—ã–ª–æ: .eq('id', user.id)
   // ‚úÖ –°—Ç–∞–ª–æ:
   .eq('id', String(user.id)) // –ü—Ä–∏–≤–æ–¥–∏–º UUID –∫ —Å—Ç—Ä–æ–∫–µ
   
   // ‚ùå –ë—ã–ª–æ: .eq('id', userId)
   // ‚úÖ –°—Ç–∞–ª–æ:
   .eq('id', String(userId)) // –ü—Ä–∏–≤–æ–¥–∏–º UUID –∫ —Å—Ç—Ä–æ–∫–µ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤
   ```

3. **–ü–µ—Ä–µ–¥–∞—á–∞ UUID –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
   ```typescript
   // ‚ùå –ë—ã–ª–æ: creatorId={selectedEventDetail.creator_id}
   // ‚úÖ –°—Ç–∞–ª–æ:
   creatorId={String(selectedEventDetail.creator_id)} // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º UUID –≤ —Å—Ç—Ä–æ–∫—É
   ```

4. **–í —Ñ—É–Ω–∫—Ü–∏—è—Ö –ø–æ–∏—Å–∫–∞:**
   ```typescript
   // ‚ùå –ë—ã–ª–æ: .find(r => r.user_id === selectedParticipantId)
   // ‚úÖ –°—Ç–∞–ª–æ:
   .find(r => String(r.user_id) === String(selectedParticipantId))
   ```

## üìã SQL –º–∏–≥—Ä–∞—Ü–∏–∏

### –ú–∏–≥—Ä–∞—Ü–∏—è 006: Email –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–ª—é—á

```sql
-- supabase/migrations/006_email_primary_key.sql
-- 1. –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ email –º–æ–∂–µ—Ç –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
CREATE UNIQUE INDEX IF NOT EXISTS profiles_email_unique 
ON profiles(email) 
WHERE email IS NOT NULL;

-- 2. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ email/phone
CREATE OR REPLACE FUNCTION public.find_profile_by_email(p_email TEXT)
RETURNS TABLE (id UUID, email TEXT, phone TEXT, telegram_id BIGINT, gender TEXT, full_name TEXT)
AS $$
BEGIN
  RETURN QUERY
  SELECT profiles.id, profiles.email, profiles.phone, profiles.telegram_id, profiles.gender, profiles.full_name
  FROM profiles
  WHERE profiles.email = LOWER(TRIM(p_email))
  LIMIT 1;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞ handle_new_user –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ email/phone
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.profiles (id, email, phone, gender, created_at, updated_at)
  VALUES (
    NEW.id,
    COALESCE(LOWER(TRIM(NEW.email)), NULL), -- email –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
    COALESCE(REGEXP_REPLACE(NEW.phone, '[^\d+]', '', 'g'), NULL), -- phone –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω
    NULL, -- gender –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é NULL
    NOW(),
    NOW()
  )
  ON CONFLICT (id) DO UPDATE
  SET 
    email = COALESCE(LOWER(TRIM(EXCLUDED.email)), profiles.email),
    phone = COALESCE(REGEXP_REPLACE(EXCLUDED.phone, '[^\d+]', '', 'g'), profiles.phone),
    gender = COALESCE(profiles.gender, EXCLUDED.gender),
    updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- 4. –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX IF NOT EXISTS profiles_email_lower_idx ON profiles(LOWER(TRIM(email))) WHERE email IS NOT NULL;
CREATE INDEX IF NOT EXISTS profiles_phone_normalized_idx ON profiles(REGEXP_REPLACE(phone, '[^\d+]', '', 'g')) WHERE phone IS NOT NULL;
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Email —Å –ø–æ–∏—Å–∫–æ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å —á–µ—Ä–µ–∑ Email: `test@example.com`, –ø–∞—Ä–æ–ª—å, –ø–æ–ª
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –¥—Ä—É–≥–æ–π –∞–∫–∫–∞—É–Ω—Ç —Å —Ç–µ–º –∂–µ email
3. ‚úÖ –î–æ–ª–∂–Ω–æ –Ω–∞–π—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ UUID
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ë–î: –æ–±–∞ –≤—Ö–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ UUID

### –¢–µ—Å—Ç 2: –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Phone —Å –ø–æ–∏—Å–∫–æ–º –ø–æ phone

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å —á–µ—Ä–µ–∑ Phone: `+79001234567`
2. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Phone —Å —Ç–µ–º –∂–µ –Ω–æ–º–µ—Ä–æ–º (–≤ –¥—Ä—É–≥–æ–º —Ñ–æ—Ä–º–∞—Ç–µ: `+7 900 123 45 67`)
3. ‚úÖ –î–æ–ª–∂–Ω–æ –Ω–∞–π—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É phone
4. ‚úÖ Email –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è

### –¢–µ—Å—Ç 3: –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram —Å –ø–æ–∏—Å–∫–æ–º –ø–æ email

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å —á–µ—Ä–µ–∑ Email: `user@example.com`
2. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram (—Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º email)
3. –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å Telegram, –¥–æ–±–∞–≤–∏–≤ `user@example.com` –∫–∞–∫ email
4. –í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ Telegram
5. ‚úÖ –î–æ–ª–∂–Ω–æ –Ω–∞–π—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ email –∏ —Å–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç—ã

### –¢–µ—Å—Ç 4: OAuth —Ä–µ–¥–∏—Ä–µ–∫—Ç Google/Apple —Å –ø–æ–∏—Å–∫–æ–º –ø–æ email

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å —á–µ—Ä–µ–∑ Email: `google@example.com`
2. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google OAuth —Å —Ç–µ–º –∂–µ email
3. ‚úÖ –î–æ–ª–∂–Ω–æ –Ω–∞–π—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ email
4. ‚úÖ –î–æ–ª–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å Google –∞–∫–∫–∞—É–Ω—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø—Ä–æ—Ñ–∏–ª–µ–º
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ë–î: –ø—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Google

### –¢–µ—Å—Ç 5: –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ–ª–∞ –ø–æ—Å–ª–µ –ª—é–±–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –≤—Ö–æ–¥–∞

1. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Email (–Ω–µ —É–∫–∞–∑—ã–≤–∞—è –ø–æ–ª –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
2. ‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è —ç–∫—Ä–∞–Ω `CompleteProfileScreen`
3. ‚úÖ –î–æ—Å—Ç—É–ø –∫ –∫–∞—Ä—Ç–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
4. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª (–ú—É–∂—á–∏–Ω–∞ / –ñ–µ–Ω—â–∏–Ω–∞)
5. ‚úÖ –î–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∫–∞—Ä—Ç–æ–π

### –¢–µ—Å—Ç 6: –†–µ–∂–∏–º Duo (–∂–µ—Å—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏)

1. –ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –Ω–∞—Ä–∏—Å—É–π—Ç–µ –∫—Ä—É–≥ –ø–∞–ª—å—Ü–µ–º
2. ‚úÖ –ü–æ—è–≤–∏—Ç—Å—è –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –ª–∏–Ω–∏—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
3. ‚úÖ –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—Ä—É–≥–∞ –ø–æ—è–≤–∏—Ç—Å—è —Ü–µ–Ω—Ç—Ä
4. –ù–∞–∂–º–∏—Ç–µ –≤ —Ü–µ–Ω—Ç—Ä –∫—Ä—É–≥–∞
5. ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–∞–∑–≤–µ—Ä–Ω–µ—Ç—Å—è –Ω–∞ 180 –≥—Ä–∞–¥—É—Å–æ–≤
6. ‚úÖ –§–æ–Ω –∏–∑–º–µ–Ω–∏—Ç—Å—è –Ω–∞ —Ç–µ–º–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
7. –°–æ–∑–¥–∞–π—Ç–µ —Å–æ–±—ã—Ç–∏–µ
8. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ë–î: `is_duo_event: true`

### –¢–µ—Å—Ç 7: –¢–∏–ø—ã UUID (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫)

1. –°–æ–∑–¥–∞–π—Ç–µ —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ Email —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
2. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google OAuth
3. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram Mini App
4. ‚úÖ –í—Å–µ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å UUID (—Å—Ç—Ä–æ–∫–∏) –±–µ–∑ –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤
5. ‚úÖ –í—Å–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è UUID –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
6. ‚úÖ –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ `operator does not exist: uuid = bigint`

## ‚ú® –ì–æ—Ç–æ–≤–æ!

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:
- ‚úÖ Email/Password —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥ —Å –ø–æ–∏—Å–∫–æ–º –ø–æ email
- ‚úÖ Phone/OTP –≤—Ö–æ–¥ —Å –ø–æ–∏—Å–∫–æ–º –ø–æ phone
- ‚úÖ Telegram WebApp –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ —Å –ø–æ–∏—Å–∫–æ–º –ø–æ telegram_id –∏ email
- ‚úÖ OAuth —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã Google/Apple —Å –ø–æ–∏—Å–∫–æ–º –ø–æ email
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –µ–¥–∏–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (email –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–ª—é—á)
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ–ª–∞ –ø–æ—Å–ª–µ –ª—é–±–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –≤—Ö–æ–¥–∞
- ‚úÖ –†–µ–∂–∏–º Duo —Å –∂–µ—Å—Ç–∫–∏–º –∞–∫—Ç–∏–≤–∞—Ç–æ—Ä–æ–º (–∫—Ä—É–≥ + —Ç–∞–ø)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ UUID (–≤—Å–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∏ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç String())

**–ü—Ä–∏–º–µ–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏—é 006 –≤ Supabase Dashboard –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è!**
