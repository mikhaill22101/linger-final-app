# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ï–¥–∏–Ω—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID (UUID –∏–∑ Supabase Auth)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Email/Password —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –≤—Ö–æ–¥–∞
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Phone (OTP) –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Telegram OAuth (Mini App –∏ standalone)
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–≤—è–∑—ã–≤–∞–Ω–∏—è Telegram –∞–∫–∫–∞—É–Ω—Ç–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º

### 2. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Telegram
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ standalone (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç Telegram)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Telegram Mini App (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å/–±–µ–∑ Telegram

### 3. –ù–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ Capacitor –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è iOS/Android
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏, haptic feedback
- ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ App Store/Google Play

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Supabase

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Authentication -> Providers
3. –í–∫–ª—é—á–∏—Ç–µ:
   - ‚úÖ Email provider
   - ‚úÖ Phone provider

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏–∏

–í Supabase Dashboard -> SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
-- –§–∞–π–ª: supabase/migrations/002_universal_user_id.sql

-- 2. –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è email, phone, telegram_id
CREATE UNIQUE INDEX IF NOT EXISTS profiles_email_unique 
ON profiles(email) WHERE email IS NOT NULL;

CREATE UNIQUE INDEX IF NOT EXISTS profiles_phone_unique 
ON profiles(phone) WHERE phone IS NOT NULL;

CREATE UNIQUE INDEX IF NOT EXISTS profiles_telegram_id_unique 
ON profiles(telegram_id) WHERE telegram_id IS NOT NULL;
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª:

```env
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
```

### –®–∞–≥ 4: –°–æ–±—Ä–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
npm run build
```

### –®–∞–≥ 5: –°–æ–∑–¥–∞—Ç—å –Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
npx cap add ios
npx cap add android

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
npm run capacitor:sync

# –û—Ç–∫—Ä—ã—Ç—å –≤ IDE
npm run capacitor:open:ios      # Xcode
npm run capacitor:open:android  # Android Studio
```

## üì± –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Email

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–∞–∂–º–∏—Ç–µ "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
3. –í–≤–µ–¥–∏—Ç–µ Email, –ü–∞—Ä–æ–ª—å, –ò–º—è
4. –ù–∞–∂–º–∏—Ç–µ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"

### –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Phone (OTP)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
3. –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
4. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ SMS

### –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram Mini App

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram ‚úÖ

### –°–≤—è–∑—ã–≤–∞–Ω–∏–µ Telegram —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º

1. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Email/Phone
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram
3. Telegram –∞–∫–∫–∞—É–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≤—è–∂–µ—Ç—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º ‚úÖ

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ï–¥–∏–Ω—ã–π ID (UUID)

–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ UUID –∏–∑ Supabase Auth:
- `id` (UUID) - –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤ —Ç–∞–±–ª–∏—Ü–µ `profiles`
- `telegram_id` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –µ—Å–ª–∏ –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram
- `email` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –µ—Å–ª–∏ –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Email
- `phone` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –µ—Å–ª–∏ –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Phone

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—Ñ–∏–ª—è

```typescript
interface Profile {
  id: string;              // UUID (primary key)
  email?: string;          // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  phone?: string;          // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  telegram_id?: number;    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  telegram_username?: string;
  full_name?: string;
  avatar_url?: string;
  bio?: string;
  gender?: 'male' | 'female' | 'prefer_not_to_say';
  created_at: string;
  updated_at: string;
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

```typescript
const userId = await getUserId(); // UUID

await supabase.from('impulses').insert({
  creator_id: userId, // UUID –≤–º–µ—Å—Ç–æ telegram_id
  content: '...',
  category: 'spark',
  is_duo_event: false,
});
```

## üì¶ –§–∞–π–ª—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

- `src/lib/auth-universal.ts` - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `src/components/AuthScreen.tsx` - –≠–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `capacitor.config.ts` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Capacitor
- `supabase/migrations/002_universal_user_id.sql` - SQL –º–∏–≥—Ä–∞—Ü–∏—è

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/lib/supabase.ts` - –í–∫–ª—é—á–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Auth (persistSession: true)
- `src/App.tsx` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `package.json` - –î–æ–±–∞–≤–ª–µ–Ω—ã Capacitor —Å–∫—Ä–∏–ø—Ç—ã

## üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –¢–µ—Å—Ç 1: –ï–¥–∏–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Email –Ω–∞ –æ–¥–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
2. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ —Ç–æ—Ç –∂–µ Email –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
3. ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –∏ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

### –¢–µ—Å—Ç 2: Telegram Mini App

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram
2. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram

### –¢–µ—Å—Ç 3: –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Email
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram
3. ‚úÖ Telegram –∞–∫–∫–∞—É–Ω—Ç —Å–≤—è–∑–∞–Ω —Å Email –∞–∫–∫–∞—É–Ω—Ç–æ–º

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å `telegram_id`, –Ω—É–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∏—Ö:

```sql
-- –í–ù–ò–ú–ê–ù–ò–ï: –í—ã–ø–æ–ª–Ω—è—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ! –°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø!

-- 1. –°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Supabase Auth –¥–ª—è –∫–∞–∂–¥–æ–≥–æ telegram_id
-- 2. –û–±–Ω–æ–≤–∏—Ç—å profiles, —Å–≤—è–∑–∞–≤ telegram_id —Å –Ω–æ–≤—ã–º UUID

-- –ü—Ä–∏–º–µ—Ä (–≤—ã–ø–æ–ª–Ω—è—Ç—å –≤—Ä—É—á–Ω—É—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):
INSERT INTO auth.users (id, email, created_at, updated_at)
VALUES (gen_random_uuid(), 'telegram_123@temp.local', NOW(), NOW());

UPDATE profiles 
SET id = (SELECT id FROM auth.users WHERE email = 'telegram_123@temp.local')
WHERE telegram_id = 123;
```

### Telegram Bot –¥–ª—è OAuth

–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ Telegram OAuth (–Ω–µ Mini App) –Ω—É–∂–µ–Ω Telegram Bot:

1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
2. –ü–æ–ª—É—á–∏—Ç–µ Bot Token
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ OAuth URL –≤ Supabase (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: Mini App –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `window.Telegram.WebApp.initDataUnsafe.user`, –ø–æ—ç—Ç–æ–º—É –æ—Ç–¥–µ–ª—å–Ω—ã–π Bot –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `UNIVERSAL_AUTH_GUIDE.md` - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `CROSS_PLATFORM_ACCOUNT.md` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç–∏
- `README_ACCOUNT.md` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –µ–¥–∏–Ω–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ

## ‚ú® –ì–æ—Ç–æ–≤–æ!

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ iOS –∏ Android –∫–∞–∫ standalone –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–¥–∏–Ω—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Email, Phone, Telegram
- ‚úÖ –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –≤ App Store/Google Play
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Telegram Mini App (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ Supabase
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
4. –°–æ–±–µ—Ä–∏—Ç–µ –Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–£–¥–∞—á–∏! üöÄ
